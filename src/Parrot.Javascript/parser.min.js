var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Parrot;(function(n){var k=function(){function n(){this.Errors=[];this.Children=[]}return n}(),d,s,h,c,r,f,l,a,v,y,e,i,o,g,nt,tt,u,t,p,w,b;n.ParrotDocument=k;d=function(){function u(){this.Errors=[]}return u.prototype.Parse=function(t){try{var i=new k,r=new n.Lexer.Tokenizer(t),u=r.Tokens(),f=new n.Stream(u),e=this;this.ParseStream(f,function(n){for(var t in n)e.ParseStatementErrors(n[t]),i.Children.push(n[t])})}catch(o){this.Errors.push(o)}return i.Errors=this.Errors,i},u.prototype.ParseStatementErrors=function(n){var i,t;if(n.Errors.length>0)for(i in n.Errors)t=n.Errors[i],t.Index+=n.Index,this.Errors.push(t)},u.prototype.ParseStream=function(n,t){for(var i,u;n.Peek()!=null;){i=n.Peek();switch(i.Type){case 3:case 14:case 2:case 1:case 4:case 6:case 18:case 19:u=this.ParseStatement(n);t(u);break;default:this.Errors.push(new r(i));n.Next()}}},u.prototype.ParseStatement=function(t){var f=t.Peek(),a,u,v,i,s,h,e,o,l,y;if(f==null)return this.Errors.push(new c),[];a=f.Type;u=null;switch(a){case 1:u=t.Next();break;case 4:case 6:break;case 3:case 14:case 2:u=t.Next();break;case 19:t.NextNoReturn();u=t.Next();break;case 18:t.NextNoReturn();u=t.Next();break;default:return this.Errors.push(new r(f)),[]}for(i=null,s=!1;t.Peek()!=null&&!s;){if(h=t.Peek(),h==null)break;switch(h.Type){case 6:case 4:case 9:i=this.ParseStatementTail(t);break;case 11:t.NextNoReturn();i=this.ParseSingleStatementTail(t,i);break;case 14:if(!(f instanceof n.Lexer.StringLiteralPipeToken)){i=this.ParseSingleStatementTail(t,i);break}case 20:if(i&&(t.NextNoReturn(),(t.Peek()==null||t.Peek().Type!==20)&&(e=this.ParseSingleStatementTail(t,i),e!=null&&e.Children.length==1))){i.Children.push(e.Children[0]);break}default:this.GetStatementFromToken(u,i,null);s=!0}}for(v=this.GetStatementFromToken(u,i,f),o=[],o.push(v);t.Peek()!=null;)if(t.Peek().Type==12){t.NextNoReturn();l=this.ParseStatement(t);for(y in l)o.push(l[y])}else break;return o},u.prototype.GetStatementFromToken=function(n,i,r){var u=n!=null?n.Content:"";if(n!=null)switch(n.Type){case 3:case 2:return new t(u,i,n.Index);case 14:return new p(u.substring(1),i,n.Index)}if(r!=null)switch(r.Type){case 19:return new w(u,null,r.Index);case 18:return new b(u,null,r.Index)}return new f(u,i,n.Index)},u.prototype.ParseSingleStatementTail=function(n,t){var i=this.ParseStatement(n),r;t||(t=new e);for(r in i)t.Children.push(i[r]);return t},u.prototype.ParseStatementTail=function(n){for(var t=new Array(3),r=!1,u,i;n.Peek()!=null&&!r;){u=n.Peek();switch(u.Type){case 6:t[1]=this.ParseParameters(n);break;case 4:t[0]=this.ParseAttributes(n);break;case 11:t[2]=this.ParseChild(n);break;case 9:t[2]=this.ParseChildren(n);r=!0;break;default:r=!0}}return i=new e,i.Attributes=t[0]||[],i.Parameters=t[1]||[],i.Children=t[2]||[],i},u.prototype.ParseChild=function(n){var r=[],t,u,i,f;for(n.NextNoReturn(),t=!1;n.Peek()!=null&&!t;){if(u=n.Peek(),u==null)break;i=this.ParseStatement(n);for(f in i)r.push(i[f]);t=!0}return r},u.prototype.ParseChildren=function(n){var u=[],t,i,r,f;for(n.NextNoReturn(),t=!1;n.Peek()!=null&&!t;){if(i=n.Peek(),i==null)break;switch(i.Type){case 12:break;case 10:n.NextNoReturn();t=!0;break;default:r=this.ParseStatement(n);for(f in r)u.push(r[f])}}return u},u.prototype.ParseParameters=function(n){var i=[],u,t;for(n.NextNoReturn(),u=!1;n.Peek()!=null&&!u;){if(t=n.Peek(),t==null)break;switch(t.Type){case 1:case 2:case 14:i.push(this.ParseParameter(n));break;case 8:n.NextNoReturn();break;case 7:n.NextNoReturn();u=!0;break;default:return this.Errors.push(new r(t)),i}}return i},u.prototype.ParseParameter=function(n){var t=n.Next();switch(t.Type){case 14:case 2:case 3:case 1:break;default:return this.Errors.push(new r(t)),null}return new y(t.Content)},u.prototype.ParseAttributes=function(n){n.Next();for(var r=[],t=null,i=!1;n.Peek()!=null&&!i;){if(t=n.Peek(),t==null)break;switch(t.Type){case 1:r.push(this.ParseAttribute(n));break;case 5:n.NextNoReturn();i=!0;break;default:this.Errors.push(new h(t.Index));i=!0}}return r},u.prototype.ParseAttribute=function(n){var f=n.Next(),o=n.Peek(),e,u;if(o!=null&&o.Type==18){if(n.NextNoReturn(),e=n.Peek(),e==null)return this.Errors.push(new r(f)),new i(f.Content,null);if(e.Type==5&&this.Errors.push(new s(e.Index)),u=this.ParseStatement(n)[0],u!=null)switch(u.Name){case"true":case"false":case"null":u=new t('"'+u.Name+'"',null,0)}return new i(f.Content,u)}return new i(f.Content,null)},u}();n.Parser=d;s=function(n){function t(t){n.call(this);this.Index=t;this.Message="Attribute must have a value"}return __extends(t,n),t}(n.ParserError);n.AttributeValueMissing=s;h=function(n){function t(t){n.call(this);this.Index=t;this.Message="Invalid attribute name"}return __extends(t,n),t}(n.ParserError);n.AttributeIdentifierMissing=h;c=function(n){function t(){n.call(this);this.Message="Unexpected end of file."}return __extends(t,n),t}(n.ParserError);n.EndOfStream=c;r=function(n){function t(t){n.call(this);this.Type=t.Type;this.Token=t.Content;this.Index=t.Index;this.Message="Unexpected token: "+this.Type}return __extends(t,n),t}(n.ParserError);n.UnexpectedToken=r;f=function(){function n(n,r,u){this.Index=u;this.Parameters=[];this.Attributes=[];this.Children=[];this.IdentifierParts=[];this.Errors=[];this.Name=null;var f=this;this.IndexOfAny(n,[".","#",":"])>-1?this.GetIdentifierParts(n,function(n){var r;switch(n.Type){case 0:n.Name.length==0?f.Errors.push(new l(n.Index-1,1)):f.AnyAttributes(function(n){return n.Key=="id"})?f.Errors.push(new v(n.Name,n.Index-1,n.Name.length+1)):(r=new t('"'+n.Name+'"',null,0),f.AddAttribute(new i("id",r)));break;case 1:n.Name.length==0?f.Errors.push(new a(1,1)):(r=new t('"'+n.Name+'"',null,0),f.AddAttribute(new i("class",r)));break;case 3:r=new t('"'+n.Name+'"',null,0);f.AddAttribute(new i("type",r));break;case 2:f.Name=n.Name?n.Name:null}f.IdentifierParts.push(n)}):f.Name=n;this.ParseStatementTail(r)}return n.prototype.AnyAttributes=function(n){for(var t in this.Attributes)if(n(this.Attributes[t]))return!0;return!1},n.prototype.ParseStatementTail=function(n){if(n!=null){if(n.Parameters!=null&&(this.Parameters=n.Parameters),n.Attributes!=null){for(var t in this.Attributes)n.Attributes.push(this.Attributes[t]);this.Attributes=n.Attributes}n.Children!=null&&(this.Children=n.Children)}},n.prototype.AddAttribute=function(n){this.Attributes.push(n)},n.prototype.IdentifierTypeFromCharacter=function(n,t){switch(n){case":":return 3;case"#":return 0;case".":return 1}return t},n.prototype.GetIdentifierParts=function(n,t){for(var i,r=0,e=2,f=4,u=0;u<n.length;u++)f=this.IdentifierTypeFromCharacter(n.charAt(u),f),f!=4&&(i=new o,i.Name=n.substring(r,r+(u-r)),i.Type=e,i.Index=r,i.Length=u-r,t(i),r=u+1,e=f,f=4);i=new o;i.Name=n.substring(r);i.Type=e;i.Index=r;t(i)},n.prototype.IndexOfAny=function(n,t){var r,i;for(r in t)if(i=n.indexOf(t[r]),i!=-1)return i;return-1},n}();n.Statement=f;l=function(n){function t(t,i){n.call(this);this.Index=t;this.Length=i;this.Message="Missing Id declaration"}return __extends(t,n),t}(n.ParserError);n.MissingIdDeclaration=l;a=function(n){function t(t,i){n.call(this);this.Index=t;this.Length=i;this.Message="Missing Class declaration"}return __extends(t,n),t}(n.ParserError);n.MissingClassDeclaration=a;v=function(n){function t(t,i,r){n.call(this);this.Id=t;this.Index=i;this.Length=r;this.Message="Element may not have more than one id"}return __extends(t,n),t}(n.ParserError);n.MultipleIdDeclarations=v;y=function(){function n(n){this.Value=n;this.CalculatedValue=n}return n.prototype.IsWrappedInQuotes=function(){return this.StartsWith(this.Value,'"')||this.StartsWith(this.Value,"'")},n.prototype.StartsWith=function(n,t){return n.length>0&&n.charAt(0)==t},n}();n.Parameter=y;e=function(){function n(){this.Parameters=[];this.Attributes=[];this.Children=[]}return n}();n.StatementTail=e;i=function(){function n(n,t){this.Key=n;this.Value=t}return n}();n.Attribute=i;o=function(){function n(){}return n}();n.Identifier=o,function(n){n[n.Id=0]="Id";n[n.Class=1]="Class";n[n.Literal=2]="Literal";n[n.Type=3]="Type";n[n.None=4]="None"}(n.IdentifierType||(n.IdentifierType={}));g=n.IdentifierType,function(n){n[n.StringLiteral=0]="StringLiteral";n[n.Property=1]="Property";n[n.Local=2]="Local";n[n.Keyword=3]="Keyword"}(n.ValueType||(n.ValueType={}));nt=n.ValueType,function(n){n[n.Literal=0]="Literal";n[n.Encoded=1]="Encoded";n[n.Raw=2]="Raw"}(n.StringLiteralPartType||(n.StringLiteralPartType={}));tt=n.StringLiteralPartType;u=function(){function n(n,t,i){this.Type=n;this.Data=t;this.Index=i;this.Length=t.length}return n}();n.StringLiteralPart=u;t=function(n){function t(t,i,r){n.call(this,"string",i,r);this.Values=[];this.ValueType=0;this.IsWrappedInQuotes(t)?(this.ValueType=0,t=t.substring(1,1+t.length-2)):this.ValueType=t=="this"?2:t=="null"||t=="true"||t=="false"?3:1;this.ValueType==0&&(this.Values=this.Parse(t))}return __extends(t,n),t.prototype.StartsWith=function(n,t){return n.length>0&&n.charAt(0)==t},t.prototype.IsWrappedInQuotes=function(n){return this.StartsWith(n,'"')||this.StartsWith(n,"'")},t.prototype.Parse=function(n){for(var o,s,r,e=[],i=0,f=new Array(n.length),t=0;t<n.length;t++)if(n.charAt(t)=="@"||n.charAt(t)=="=")if(o=n.charAt(t),s=o=="@"?1:2,t++,n.charAt(Math.min(n.length-1,t))==o)f[i++]=o;else if(this.IsIdentifierHead(n.charAt(t))){for(i>0&&e.push(new u(0,f.join(""),t-i)),i=0,r="";t<n.length;t++,i++){if(!this.IsIdTail(n.charAt(t)))break;r+=n.charAt(t)}r.charAt(r.length-1)=="."?(r=r.substring(0,r.length-1),e.push(new u(s,r,t-i)),i=0,f[i++]="."):(e.push(new u(s,r,t-i)),i=0);t<n.length&&(f[i++]=n.charAt(t))}else f[i++]=o,t-=1;else f[i++]=n.charAt(t);return i>0&&e.push(new u(0,f.join(""),n.length-i)),e},t.prototype.IsIdentifierHead=function(n){return n.match(/[a-zA-Z]/)!=null||n=="_"||n=="#"||n=="."},t.prototype.IsIdTail=function(n){return n.match(/[0-9]/)!=null||this.IsIdentifierHead(n)||n==":"||n=="-"},t}(f);n.StringLiteral=t;p=function(n){function t(t,i,r){n.call(this,'"'+t+'"',i,r)}return __extends(t,n),t}(t);n.StringLiteralPipe=p;w=function(n){function t(t,i,r){n.call(this,'"@'+t+'"',i,r)}return __extends(t,n),t}(t);n.EncodedOutput=w;b=function(n){function t(t,i,r){n.call(this,'"='+t+'"',i,r)}return __extends(t,n),t}(t);n.RawOutput=b})(Parrot||(Parrot={}));
/*
//# sourceMappingURL=parser.min.js.map
*/